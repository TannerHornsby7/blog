@use "./base.scss";
@use "./variables.scss" as *;
@use "_table.scss";
@use "colors.scss";

$fonts-dir: "/static/styles/fonts";

@mixin font-face($font-family, $file-name, $ext: ".ttf", $font-features: none) {
  @font-face {
    font-family: $font-family;
    font-optical-sizing: auto;
    font-feature-settings: $font-features;

    src: url("#{$fonts-dir}/#{$file-name}#{$ext}");
  }
}

@include font-face("EBGaramond", "ebgaramond08-regular", ".woff2");
@include font-face("DejaVuSerifCondensed-Bold", "DejaVuSerifCondensed-Bold-subset", ".woff2");
@include font-face("EBGaramond12", "EBGaramond12-Regular", ".woff2");
@include font-face("EBGaramondItalic", "ebgaramond08-italics", ".woff2");
@include font-face("EBGaramondSC", "ebgaramondsc08-regular", ".woff2");
@include font-face("FiraCode", "firacode-vf", ".woff2");
@include font-face("BadHandwriting", "badhandwriting-webfont", ".woff2");

body,
.published-container {
  --font-monospace: "FiraCode", "JetBrains Mono", "Courier New", monospace;
  --font-monospace-theme: "FiraCode", "JetBrains Mono", "Courier New", monospace;

  --font-text-theme: "EBGaramond", Garamond, serif;
  --font-text: "EBGaramond", Garamond, serif;
  --font-text-italic: "EBGaramondItalic", Garamond, serif;
  --font-text-header: "EBGaramond12", Garamond, serif;

  --font-text-sc: "EBGaramondSC", "EB Garamond:smcp", "Garamond SC", small-caps, serif;
  --font-text-swash: "EB Garamond:+swsh", cursive;
  --font-bad-handwriting: "BadHandwriting";

  // Font size -- from the LW style
  // TODO standardize fonts
  --font-size-base: 13px;
  --font-size-tiny: 0.7em;
  --font-size-small: 0.75em;
  --font-size-normal: 1em;
  --font-size-big: 1.4em;
  --font-size-large: 1.8em;
  --font-size-h1: 2.8rem;
  --font-size-h2: 2.1rem;
  --font-size-h3: 1.7rem;
  font-size: 13px;

  --ornament-size: 4rem;

  font-family: var(--font-text);
  /* Use a '1' which doesn't look like an 'l' */
  font-feature-settings:
    "cv11" 1,
    "onum" 1;
}

.explorer {
  font-size: 1.4rem;
  text-align: center;
  line-height: 1.9rem;

  & a {
    text-decoration: none;
  }
  & .visited {
    color: inherit;
  }
}

.center {
  max-width: 50rem;
  font-size: 1.4rem;
  line-height: 2rem;
}

em {
  font-style: italic;
  font-family: var(--font-text-italic);
}

ol {
  --li-margin: 4px; // Ensure list items are spaced more than just line-height
  & li {
    counter-increment: list; // Increment the list counter for each list item
    list-style-type: none; // Remove default list item numbering
    margin-bottom: var(--li-margin);

    &::before {
      font-feature-settings: "lnum"; // Use lining figures for all ordered list numbers
      color: var(--gray);
      content: counters(list, ".") "."; // Display the list counter with periods
      flex-shrink: 0; // Prevent the number from shrinking
      display: inline;
      margin-right: 0.25em;
    }

    // Nested lists
    ol {
      counter-reset: sublist; // Each nested ordered list has its own sublist counter
      li {
        counter-increment: sublist; // Increment the sublist counter for nested list items
        &::before {
          content: counters(list, ".") "." counters(sublist, "."); // Display combined list and sublist counters for nested list items
        }
        &:first-child {
          margin-top: var(--li-margin); // Remove top margin from the first nested list item
        }
      }
    }
  }

  // This comes in an h2 right before the footnotes.
  .footnote-label {
    counter-reset: footnote;
  }

  li[id^="user-content-fn-"] {
    // Target li elements whose id attribute value starts with 'user-content-fn-'
    counter-increment: footnote; // Increment the footnote counter for each matching li
    display: flex; // This ensures the number and the text are in the same line
    font-size: smaller;

    // Make the backref arrows look nice
    & .data-footnote-backref {
      color: color-mix(in srgb, var(--color-link) 70%, transparent);
      text-decoration: none;
      background-color: transparent;
      font-family: "DejaVuSerifCondensed-Bold", serif;
      font-size: larger;
    }

    & p {
      // TODO fix this for fn 15
      margin-bottom: 8px; /* Adjust the spacing as needed */
    }

    &::before {
      content: counter(footnote) "."; // Display the counter followed by a period
    }
  }
}

/* Headings should have full-height numbers */
h1,
h2,
h3 {
  font-feature-settings:
    "onum" 0,
    "lnum" 1;
  color: var(--color-header);
  font-family: var(--font-text-header);
  line-height: 1em;

  & .small-caps {
    font-weight: lighter;
  }
}

article {
  & h1 {
    font-size: var(--font-size-h1);
  }
  & h2 {
    font-size: var(--font-size-h2);
  }
  & h3 {
    font-size: var(--font-size-h3);
  }
}

/* Set monospace font for code blocks, inline code, etc. */
code,
pre {
  font-family: var(--font-monospace);
  background-color: var(--color-background);
  color: inherit;
}

/* Wrap links properly */
a {
  color: var(--color-link);
  white-space: normal;
  word-break: break-word;
  hyphens: auto;
  margin-top: 0em;

  // After you visit a link, it becomes less important that it stands out
  &:visited {
    color: color-mix(in srgb, currentcolor 50%, var(--color-link));
  }
  // Don't have anchor links with box behind them
  &[role="anchor"] {
    background-color: transparent;
  }

  &[href^="mailto:"] {
    font-family: var(--font-monospace);
    font-size: 0.75em;
  }
}

audio {
  width: 85%;
  border: light-dark(1px solid var(--lightgray), 0px);
}

sup {
  line-height: 0; // Don't push other lines away
}

.text-ornament {
  font-family: var(--font-text-header);
  font-size: var(--ornament-size);
  filter: saturate(90%); //drop-shadow(0 0 1.2px light-dark(transparent, white));
  color: var(--blue);
  opacity: light-dark(0.7, 0.7);
}

.trout-ornament {
  filter: light-dark(none, invert(66%));
  opacity: light-dark(0.5, 1);
}

// The image in the title
// Always applied
.header-img {
  filter: light-dark(saturate(85%), saturate(75%));
}
// NOTE this will stop working if address moves TODO fix
body[data-slug="Essays/Bruce-Wayne-and-the-cost-of-inaction"] {
  & .header-img {
    filter: saturate(0%);
  }
}

/* Center the site name under the pond gif */
.page-title {
  font-feature-settings: "swsh" 1;
  font-family: var(--font-text-swash), cursive, sans-serif;
  text-align: center;

  & a {
    color: inherit;
    text-decoration: none;
  }

  @media all and (min-width: $fullPageWidth) {
    margin-top: -1.4em;
    color: var(--gray);
    font-size: var(--font-size-h2);
  }
}

// When screen is smaller
@media all and (max-width: $fullPageWidth) {
  .header-img {
    margin-right: 0.9rem;
    margin-left: 0.5rem;
    width: 2em;
    vertical-align: -100%;
  }
  .page-title {
    font-size: 2.2rem;
  }
}

/* Specific elements and features */
.gold-script {
  font-family: var(--font-text-swash);
  font-feature-settings: "swsh" 1;
  color: light-dark(#daa520, #ffd700); /* Gold */

  // Make it easier to see on light themes
  -webkit-text-stroke: 0.2px light-dark(black, transparent);
}

.bad-handwriting {
  font-family: var(--font-bad-handwriting);
  text-align: center;
  font-style: italic;
  font-size: 1.5em;
  margin-top: 1em;
  margin-bottom: 1em;
}

figure img {
  margin-bottom: 1em;
}

figcaption {
  text-align: center;
  color: var(--overlay-2);
  // font-style: normal;
  font-size: 0.82em; /* smaller than the surrounding text */
  margin-top: 0em; /* Space above the caption */
}

.small-caps {
  font-family: var(--font-text-sc);
  font-size: 1.1em; // 1.1x the inherited size

  font-style: inherit;
  text-transform: lowercase;
  -webkit-font-smoothing: antialiased; /* Prevent excess bolding */

  &:visited {
    color: var(--color-visited);
  }
}

.no-select {
  user-drag: none;
  -webkit-user-drag: none;
  user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
}

/* Ensure favicons have appropriate properties. */
.favicon {
  width: 0.65em;
  height: 0.65em;
  margin-right: auto;
  vertical-align: 25%;
  filter: saturate(40%);
  margin-bottom: -0.07em;
  margin-top: -0.07em;
}

.book-citation {
  font-style: italic;
}

// NOTE not used in main site
.kofi-image {
  height: 1.2em;
  vertical-align: -1em;
  margin-right: 0.15em;
  filter: hue-rotate(200deg) opacity(0.6);
}

.header-404 {
  color: var(--gray);
  line-height: 0.1em;
  margin-top: 18%;
}

img.emoji {
  border-radius: 0; // Don't want to cut off corners
  height: 1em;
  width: 1em;
  margin: 0 0.05em 0 0.1em;
  vertical-align: -0.1em;
}
