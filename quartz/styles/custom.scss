@use "./base.scss";
@use "./variables.scss" as *;
@use "_table.scss";
@use "colors.scss";

$fonts-dir: '/static/fonts'; 

@mixin font-face($font-family, $file-name, $ext: '.ttf', $font-features: none){
  @font-face {
    font-family: $font-family;
    font-optical-sizing: auto; 
    font-feature-settings: $font-features;

    src: url('#{$fonts-dir}/#{$file-name}#{$ext}')
  }
}

@include font-face('EBGaramond', 'EBGaramond08-Regular', '.otf');
@include font-face('EBGaramond12', 'EBGaramond12-Regular', '.otf');
@include font-face('EBGaramondItalic', 'EBGaramond08-Italic', '.otf');
@include font-face('EBGaramondSC', 'EBGaramondSC08-Regular', '.otf'); 
@include font-face('FiraCode', 'FiraCode-VF', '.ttf');
@include font-face('BadHandwriting', 'BadHandwriting', '.ttf'); 

body, .published-container {
  --font-monospace: "FiraCode", 'JetBrains Mono', 'Courier New', monospace;
  --font-monospace-theme: "FiraCode", 'JetBrains Mono', 'Courier New', monospace;

  --font-text-theme: 'EBGaramond', Garamond, serif;
  --font-text: 'EBGaramond', Garamond, serif;
  --font-text-italic: 'EBGaramondItalic', Garamond, serif;
--font-text-header: 'EBGaramond12', Garamond, serif;

  --font-text-sc: 'EBGaramondSC', 'EB Garamond:smcp', "Garamond SC", small-caps, serif;
  --font-text-swash: 'EB Garamond:+swsh', cursive;
  --font-bad-handwriting: "BadHandwriting";

  font-family: var(--font-text);
  /* Use a '1' which doesn't look like an 'l' */
  font-feature-settings: "cv11" 1, "onum" 1;

  // background-color: var(--dark);

  /* Text which is meant to be read thoroughly should
   * have a shorter character limit to improve readability */
   // max-width: fit-content(60ch);
}

em {
  font-style: italic;
  font-family: var(--font-text-italic);
}

ol {
  counter-reset: list; // Reset the list counter at the top-level ordered list
  li {
    counter-increment: list; // Increment the list counter for each list item
    list-style-type: none; // Remove default list item numbering
    
    &::before {
      font-feature-settings: "lnum"; // Use lining figures for all ordered list numbers
      color: var(--gray);
      content: counters(list, ".") "."; // Display the list counter with periods
        flex-shrink: 0; // Prevent the number from shrinking
    margin-right: .5em;
    }
    
    // Nested lists
    ol {
      counter-reset: sublist; // Each nested ordered list has its own sublist counter
      li {
        counter-increment: sublist; // Increment the sublist counter for nested list items
        &::before {
          content: counters(list, ".") "." counters(sublist, "."); // Display combined list and sublist counters for nested list items
        }
      }
    }
  }
  
  // This comes in an h2 right before the footnotes.
  .footnote-label {
    counter-reset: footnote;
  }

  li[id^="user-content-fn-"] {
    // Target li elements whose id attribute value starts with 'user-content-fn-'
    counter-increment: footnote; // Increment the footnote counter for each matching li
    display: flex; // This ensures the number and the text are in the same line
      
    &::before {
      content: counter(footnote) "."; // Display the counter followed by a period
    }
  }
}

/* Headings should have full-height numbers */
h1,
h2,
h3 {
  font-feature-settings: "onum" 0, "lnum" 1;
  color: var(--color-header);
font-family: var(--font-text-header);

& .small-caps {
    font-weight: lighter;
}
}

/* Set monospace font for code blocks, inline code, etc. */
code, pre {
  font-family: var(--font-monospace);
  background: color-mix(in srgb, var(--lightgray) 30%, var(--light));
}

/* Wrap links properly */
a {
    color: light-dark(color-mix(in srgb, var(--secondary) 30%, var(--dark)), var(--secondary));
  white-space: normal;
  word-break: break-word;
  hyphens: auto;
  margin-top: 0em;

& .small-caps {
    font-weight: lighter;
}
}

// Ensure footnote return arrows have appropriately sized backgrounds
a.data-footnote-backref {
    height: .9em;
    display: inline-block;
}

audio {
  width: 85%;
  border: 1px solid var(--lightgray);
}

sup {
  line-height: 0; // Don't push other lines away
}

// The image in the title 
@media all and (max-width: $fullPageWidth) {
    .header-img {
        margin-right: .9rem;
        margin-left: .5rem;
        width: 2em;
        vertical-align: -100%;
    }
}

/* Center the site name under the pond gif */
.page-title {
    text-align: center;
}

/* Allow inline emoji to resize with the text */
.emoji {
  max-width: 1em;
  max-height: 1em;
  width: auto;
  height: auto;
}


/* Specific elements and features */
.gold-script {
  font-family: var(--font-text-swash);
  font-feature-settings: "swsh" 1;
  color: light-dark(#DAA520, #FFD700); /* Gold */

  // Make it easier to see on light themes
  -webkit-text-stroke: .2px light-dark(black, transparent);
}


.bad-handwriting {
  font-family: var(--font-bad-handwriting);
  text-align: center;
  font-style: italic;
  font-size: 1.5em;
  margin-top: 1em;
  margin-bottom: 1em;
}

.caption {
  text-align: center;
  color: var(--overlay-2);
  font-style: normal;
  font-size: 0.8em; /* smaller than the surrounding text */
  margin-top: 0.5em; /* Space above the caption */
  margin-bottom: 1em; /* Space below the caption */
}

.small-caps {
    font-family: var(--font-text-sc);
  font-size: 1.1em; // 1.1x the inherited size

  color: inherit;
  text-transform: lowercase; 
  -webkit-font-smoothing: antialiased; /* Prevent excess bolding */
}

/* Remove the external link icon. */
.external-icon {
    display: none;
}

/* Ensure favicons have appropriate properties. */ 
.favicon {
    width: .75em;
    height: .75em;
    margin-right: .1em;
    vertical-align: 25%;
    filter: saturate(40%);
    margin-bottom: -.07em;
    margin-top: -.07em;
}

