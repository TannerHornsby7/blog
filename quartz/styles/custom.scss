@use "./base.scss";
@use "./variables.scss" as *;
@use "_table.scss";
@use "colors.scss";

$fonts-dir: "/static/fonts";

@mixin font-face($font-family, $file-name, $ext: ".ttf", $font-features: none) {
  @font-face {
    font-family: $font-family;
    font-optical-sizing: auto;
    font-feature-settings: $font-features;

    src: url("#{$fonts-dir}/#{$file-name}#{$ext}");
  }
}

@include font-face("EBGaramond", "EBGaramond08-Regular", ".otf");
@include font-face("DejaVuSerifCondensed-Bold", "DejaVuSerifCondensed-Bold", ".ttf");
@include font-face("EBGaramond12", "EBGaramond12-Regular", ".otf");
@include font-face("EBGaramondItalic", "EBGaramond08-Italic", ".otf");
@include font-face("EBGaramondSC", "EBGaramondSC08-Regular", ".otf");
@include font-face("FiraCode", "FiraCode-VF", ".ttf");
@include font-face("BadHandwriting", "BadHandwriting", ".ttf");

body,
.published-container {
  --font-monospace: "FiraCode", "JetBrains Mono", "Courier New", monospace;
  --font-monospace-theme: "FiraCode", "JetBrains Mono", "Courier New", monospace;

  --font-text-theme: "EBGaramond", Garamond, serif;
  --font-text: "EBGaramond", Garamond, serif;
  --font-text-italic: "EBGaramondItalic", Garamond, serif;
  --font-text-header: "EBGaramond12", Garamond, serif;

  --font-text-sc: "EBGaramondSC", "EB Garamond:smcp", "Garamond SC", small-caps, serif;
  --font-text-swash: "EB Garamond:+swsh", cursive;
  --font-bad-handwriting: "BadHandwriting";

  // Font size -- from the LW style
  // TODO standardize fonts
  --font-size-base: 13px;
  --font-size-tiny: 0.7em;
  --font-size-small: 0.75em;
  --font-size-normal: 1em;
  --font-size-big: 1.4em;
  --font-size-large: 1.8em;
  font-size: 13px;

  font-family: var(--font-text);
  /* Use a '1' which doesn't look like an 'l' */
  font-feature-settings:
    "cv11" 1,
    "onum" 1;
}

div {
  & .explorer-content,
  & .toc-content {
    // line-height: 10em;
  }
}

.center {
  max-width: 50rem;
  font-size: 1.4rem;
  line-height: 2rem;
}

em {
  font-style: italic;
  font-family: var(--font-text-italic);
}

ol {
  --li-margin: 4px; // Ensure list items are spaced more than just line-height
  counter-reset: list; // Reset the list counter at the top-level ordered list
  li {
    counter-increment: list; // Increment the list counter for each list item
    list-style-type: none; // Remove default list item numbering
    margin-bottom: var(--li-margin);

    &::before {
      font-feature-settings: "lnum"; // Use lining figures for all ordered list numbers
      color: var(--gray);
      content: counters(list, ".") "."; // Display the list counter with periods
      flex-shrink: 0; // Prevent the number from shrinking
      margin-right: 0.25em;
    }

    // Nested lists
    ol {
      counter-reset: sublist; // Each nested ordered list has its own sublist counter
      li {
        counter-increment: sublist; // Increment the sublist counter for nested list items
        &::before {
          content: counters(list, ".") "." counters(sublist, "."); // Display combined list and sublist counters for nested list items
        }
        &:first-child {
          margin-top: var(--li-margin); // Remove top margin from the first nested list item
        }
      }
    }
  }

  // This comes in an h2 right before the footnotes.
  .footnote-label {
    counter-reset: footnote;
  }

  li[id^="user-content-fn-"] {
    // Target li elements whose id attribute value starts with 'user-content-fn-'
    counter-increment: footnote; // Increment the footnote counter for each matching li
    display: flex; // This ensures the number and the text are in the same line
    font-size: smaller;

    // Make the backref arrows look nice
    & .data-footnote-backref {
      color: color-mix(in srgb, var(--color-link) 70%, transparent);
      background-color: transparent;
      font-family: "DejaVuSerifCondensed-Bold", serif;
      font-size: larger;
    }

    & p {
      // TODO fix this for fn 15
      margin-bottom: 8px; /* Adjust the spacing as needed */
    }

    &::before {
      content: counter(footnote) "."; // Display the counter followed by a period
    }
  }
}

/* Headings should have full-height numbers */
h1,
h2,
h3 {
  font-feature-settings:
    "onum" 0,
    "lnum" 1;
  color: var(--color-header);
  font-family: var(--font-text-header);
  line-height: 1em;

  & .small-caps {
    font-weight: lighter;
  }
}

article {
  & h1 {
    font-size: 2.8rem;
  }
  & h2 {
    font-size: 2.1rem;
  }
  & h3 {
    font-size: 1.7rem;
  }
}

/* Set monospace font for code blocks, inline code, etc. */
code,
pre {
  font-family: var(--font-monospace);
  background: color-mix(in srgb, var(--lightgray) 30%, var(--light));
}

/* Wrap links properly */
a {
  color: var(--color-link);
  white-space: normal;
  word-break: break-word;
  hyphens: auto;
  margin-top: 0em;

  &:visited {
    color: var(--color-visited);
  }
  // Don't have anchor links with box behind them
  &[role="anchor"] {
    background-color: transparent;
  }
}

audio {
  width: 85%;
  border: light-dark(1px solid var(--lightgray), 0px);
}

sup {
  line-height: 0; // Don't push other lines away
}

// The image in the title
// Always applied
.header-img {
  filter: light-dark(saturate(85%), saturate(75%));
}
body[data-slug="Essays/Bruce-Wayne-and-the-cost-of-inaction"] .header-img {
  filter: saturate(0%);
}
// When screen is smaller
@media all and (max-width: $fullPageWidth) {
  .header-img {
    margin-right: 0.9rem;
    margin-left: 0.5rem;
    width: 2em;
    vertical-align: -100%;
  }
}

/* Center the site name under the pond gif */
.page-title {
  text-align: center;
}

/* Allow inline emoji to resize with the text */
.emoji {
  max-width: 1em;
  max-height: 1em;
  width: auto;
  height: auto;
}

/* Specific elements and features */
.gold-script {
  font-family: var(--font-text-swash);
  font-feature-settings: "swsh" 1;
  color: light-dark(#daa520, #ffd700); /* Gold */

  // Make it easier to see on light themes
  -webkit-text-stroke: 0.2px light-dark(black, transparent);
}

.bad-handwriting {
  font-family: var(--font-bad-handwriting);
  text-align: center;
  font-style: italic;
  font-size: 1.5em;
  margin-top: 1em;
  margin-bottom: 1em;
}

img .fade-img {
  position: relative;
}

img .fade-img:after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(to bottom, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 1) 100%);
  height: 40%;
}

.caption {
  text-align: center;
  color: var(--overlay-2);
  font-style: normal;
  font-size: 0.82em; /* smaller than the surrounding text */
  margin-top: 0em; /* Space above the caption */
}

.small-caps {
  font-family: var(--font-text-sc);
  font-size: 1.1em; // 1.1x the inherited size

  font-style: inherit;
  text-transform: lowercase;
  -webkit-font-smoothing: antialiased; /* Prevent excess bolding */

  &:visited {
    color: var(--color-visited);
  }
}

/* Remove the external link icon. */
.external-icon {
  display: none;
}

.no-select {
  user-drag: none;
  -webkit-user-drag: none;
  user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
}

/* Ensure favicons have appropriate properties. */
.favicon {
  width: 0.65em;
  height: 0.65em;
  margin-right: 0.22em;
  vertical-align: 25%;
  filter: saturate(40%);
  margin-bottom: -0.07em;
  margin-top: -0.07em;
}

// .favicon-span {
//   white-space: nowrap;
// }

img.emoji {
  height: 1em;
  width: 1em;
  margin: 0 0.05em 0 0.1em;
  vertical-align: -0.1em;
}
